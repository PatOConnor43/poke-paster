use image::{GenericImage, GenericImageView, ImageOutputFormat, Pixel};
use rand::seq::IteratorRandom;
use reqwest::{
    header::{HeaderMap, HeaderValue},
    StatusCode,
};
use serde::{Deserialize, Serialize};
use serde_json::Value;
use std::{
    error::Error,
    fs::File,
    io::{BufRead, BufReader, Cursor},
};

const FILENAME: &str = "ids";

#[derive(Default, Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Paste {
    pub author: String,
    pub notes: String,
    #[serde(rename = "paste")]
    pub body: String,
    pub title: String,
}

fn main() -> Result<(), Box<dyn Error>> {
    let domain = std::env::var("MASTODON_DOMAIN").expect("Missing Mastodon domain env var");
    let token = std::env::var("ACCESS_TOKEN").expect("Missing access token env var");
    let f = File::open(FILENAME)?;
    let f = BufReader::new(f);

    let lines = f.lines().map(|l| l.expect("Couldn't read line"));

    let paste_id = lines.choose(&mut rand::thread_rng()).unwrap();
    let names = get_names(&paste_id)?;
    let post_body_text = format!(
        r"
New Poke Paste!
https://pokepast.es/{}
Featuring:{}
",
        paste_id,
        names
            .iter()
            .fold(String::from(""), |a, b| format!("{}\n- {}", a, b))
    );

    // Use the open function to load an image from a Path.
    // `open` returns a `DynamicImage` on success.
    let mut img = image::open("poster/assets/background-named.png")?.to_rgba8();
    draw_pokemon(names, &mut img);
    draw_trainer(&mut img);
    draw_badges(&mut img);

    // Mastodon preview shows a 16:9 ratio so we're going to create a new image in that ratio so
    // the preview fits well.
    let mut ratioed_image = image::DynamicImage::new_rgba8(285, 171);
    for (x, y, value) in img.enumerate_pixels() {
        ratioed_image.put_pixel(x, y, *value);
    }

    ratioed_image.save("poster/assets/generated.png")?;
    let mut writing_cursor = Cursor::new(vec![]);
    ratioed_image.write_to(&mut writing_cursor, ImageOutputFormat::Png)?;
    let b = writing_cursor.into_inner();

    let client = reqwest::blocking::ClientBuilder::default().build()?;
    let file_part = reqwest::blocking::multipart::Part::bytes(b)
        .file_name("background.png")
        .mime_str("image/png")?;
    let form = reqwest::blocking::multipart::Form::default().part("file", file_part);
    let mut headers: HeaderMap<HeaderValue> = HeaderMap::default();
    headers.insert(
        reqwest::header::AUTHORIZATION,
        format!("Bearer {}", token).parse()?,
    );
    headers.insert("Idempotency-Key", paste_id.parse()?);

    let upload_response = client
        .post(format!("{}/api/v2/media", domain))
        .headers(headers.clone())
        .multipart(form)
        .send()?;
    let text = upload_response.text()?;
    let upload_json = serde_json::from_str::<Value>(&text)?;

    let id = upload_json
        .get("id")
        .and_then(|value| value.as_str())
        .and_then(|value| Some(value.to_string()));
    let id = id.unwrap();

    std::thread::sleep(std::time::Duration::from_secs(5));
    let status_response = client
        .get(format!("{}/api/v1/media/{}", domain, id))
        .headers(headers.clone())
        .send()?;
    match status_response.status() {
        StatusCode::OK => println!("Uploaded attachment"),
        StatusCode::PARTIAL_CONTENT => {
            println!("Upload still processing. Retrying.");

            std::thread::sleep(std::time::Duration::from_secs(5));
            let status_response = client
                .get(format!("{}/api/v1/media/{}", domain, id))
                .headers(headers.clone())
                .send()?;
            if status_response.status() != 200 {
                panic!(
                    "Status check failed after retry. Giving up. HTTP {}",
                    status_response.status()
                )
            }
        }
        _ => panic!(
            "Unexpected status code when checking upload. HTTP {}",
            status_response.status()
        ),
    }

    let form = reqwest::blocking::multipart::Form::default()
        .text("status", post_body_text)
        .text("visibility", "private")
        .text("media_ids[]", id);
    let status_response = client
        .post(format!("{}/api/v1/statuses", domain))
        .headers(headers)
        .multipart(form)
        .send()?;
    dbg!(status_response.json::<Value>()?);

    Ok(())
}

fn draw_badges(img: &mut image::RgbaImage) {
    let xoffset = 20;
    let xinitial = 39;
    let yinitial = 16;
    for i in 0..8 {
        let badge = image::open(format!("poster/assets/badges/kalos/{}.png", i)).unwrap();
        for (x, y, value) in badge.pixels() {
            img.get_pixel_mut(
                xinitial + x + (xoffset * i),
                img.dimensions().1 - badge.dimensions().1 - yinitial + y,
            )
            .blend(&value);
        }
    }
}

fn draw_trainer(img: &mut image::RgbaImage) {
    let trainer = image::open("poster/assets/trainers/1150.png").unwrap();
    let padding = 5;
    // This draws the trainer from the right side of the image in an attempt to make sure we don't
    // go out of bounds.
    for (x, y, value) in trainer.pixels() {
        img.get_pixel_mut(
            img.dimensions().0 - trainer.dimensions().0 - padding + x,
            49 + y,
        )
        .blend(&value);
    }
}

fn draw_pokemon(names: Vec<String>, img: &mut image::RgbaImage) {
    let default = image::open("poster/assets/placeholder.png").unwrap();
    let xoffset = 55;
    let yoffset = 36;
    let mut i = 0;
    for name in names.iter() {
        let column = i % 3;
        let second_row = match i {
            0 => 0,
            1 => 0,
            2 => 0,
            _ => 1,
        };
        let portrait =
            image::open(format!("poster/assets/pokemon/{}.png", name)).unwrap_or(default.clone());
        for (x, y, value) in portrait.pixels() {
            img.put_pixel(
                7 + x + (column * xoffset),
                49 + y + (second_row * yoffset),
                value,
            );
        }
        i += 1;
    }
}

fn get_names(id: &str) -> Result<Vec<String>, Box<dyn Error>> {
    let client = reqwest::blocking::ClientBuilder::default().build()?;
    let response = client
        .get(format!("https://pokepast.es/{}/json", id))
        .send()?
        .text()?;
    let paste: Paste = serde_json::from_str(&response)?;
    let first_lines = paste
        .body
        .split("\r\n\r\n")
        .filter_map(|l| {
            let mut a = l.split("\r\n");
            if let Some(text) = a.next() {
                if text != "" {
                    return Some(text);
                }
            }
            None
        })
        .map(|s| s.trim().to_string())
        .collect::<Vec<String>>();

    // Taken from
    // https://github.com/felixphew/pokepaste/blob/v3/syntax.go#L27
    let lmao = regex_lite::Regex::new(
        r"^(?:(.* \()([A-Z][a-z0-9:']+\.?(?:[- ][A-Za-z][a-z0-9:']*\.?)*)(\))|([A-Z][a-z0-9:']+\.?(?:[- ][A-Za-z][a-z0-9:']*\.?)*))(?:( \()([MF])(\)))?(?:( @ )([A-Z][a-z0-9:']*(?:[- ][A-Z][a-z0-9:']*)*))?( *)",
    )?;

    let mut names: Vec<String> = vec![];
    for line in first_lines {
        for m in lmao.captures_iter(&line) {
            if let Some(no_nickname) = m.get(4) {
                // If capture 4 is set, there is no nickname
                names.push(no_nickname.as_str().to_string().to_lowercase());
            } else {
                if let Some(nickname) = m.get(2) {
                    // nickname is set as capture 1, but I need the species
                    names.push(nickname.as_str().to_string().to_lowercase());
                }
            }
        }
    }
    dbg!(&names);
    Ok(names)
}

#[cfg(test)]
mod test {
    use std::error::Error;

    const ALL_NAMES: &[&str] = &[
        "0",
        "abomasnow-f",
        "abomasnow-mega",
        "abomasnow",
        "abra",
        "absol-mega",
        "absol",
        "accelgor",
        "aegislash-blade",
        "aegislash",
        "aerodactyl-mega",
        "aerodactyl",
        "aggron-mega",
        "aggron",
        "aipom-f",
        "aipom",
        "alakazam-f",
        "alakazam-mega",
        "alakazam",
        "alcremie-caramelswirl",
        "alcremie-gmax",
        "alcremie-lemoncream",
        "alcremie-matchacream",
        "alcremie-mintcream",
        "alcremie-rainbowswirl",
        "alcremie-rubycream",
        "alcremie-rubyswirl",
        "alcremie-saltedcream",
        "alcremie",
        "alomomola",
        "altaria-mega",
        "altaria",
        "amaura",
        "ambipom-f",
        "ambipom",
        "amoonguss",
        "ampharos-mega",
        "ampharos",
        "annihilape",
        "anorith",
        "appletun-gmax",
        "appletun-shiny",
        "appletun",
        "applin",
        "araquanid",
        "arbok",
        "arboliva",
        "arcanine-hisui",
        "arcanine",
        "arceus-bug",
        "arceus-dark",
        "arceus-dragon",
        "arceus-electric",
        "arceus-fairy",
        "arceus-fighting",
        "arceus-fire",
        "arceus-flying",
        "arceus-ghost",
        "arceus-grass",
        "arceus-ground",
        "arceus-ice",
        "arceus-normal",
        "arceus-poison",
        "arceus-psychic",
        "arceus-rock",
        "arceus-steel",
        "arceus-water",
        "arceus",
        "archen",
        "archeops",
        "arctibax",
        "arctovish-shiny",
        "arctovish",
        "arctovolt",
        "arctozolt-shiny",
        "arctozolt",
        "argalis",
        "arghonaut-f",
        "arghonaut",
        "ariados",
        "armaldo",
        "armarouge",
        "aromatisse",
        "aron",
        "arrokuda",
        "articuno-galar",
        "articuno",
        "astrolotl",
        "audino-mega",
        "audino",
        "aurorus",
        "aurumoth",
        "avalugg-hisui",
        "avalugg",
        "axew",
        "azelf",
        "azumarill",
        "azurill",
        "bagon",
        "baltoy",
        "banette-mega",
        "banette",
        "barbaracle",
        "barboach",
        "barraskewda",
        "basculegion-f",
        "basculegion",
        "basculin-bluestriped",
        "basculin-whitestriped",
        "basculin",
        "bastiodon",
        "baxcalibur",
        "bayleef",
        "beartic",
        "beautifly-f",
        "beautifly",
        "beedrill-mega",
        "beedrill",
        "beheeyem",
        "beldum",
        "bellibolt",
        "bellossom",
        "bellsprout",
        "bergmite",
        "bewear",
        "bibarel-f",
        "bibarel",
        "bidoof-f",
        "bidoof",
        "binacle",
        "bisharp",
        "blacephalon",
        "blastoise-gmax",
        "blastoise-mega",
        "blastoise",
        "blaziken-f",
        "blaziken-mega",
        "blaziken",
        "blipbug-shiny",
        "blipbug",
        "blissey",
        "blitzle",
        "boldore",
        "boltund",
        "bombirdier",
        "bonsly",
        "bouffalant",
        "bounsweet",
        "braixen",
        "brambleghast",
        "bramblin",
        "brattler",
        "braviary-hisui",
        "braviary",
        "breezi",
        "breloom",
        "brionne",
        "bronzong",
        "bronzor",
        "brutebonnet",
        "bruxish",
        "budew",
        "buizel",
        "bulbasaur",
        "buneary",
        "bunnelby",
        "burmy-plant",
        "burmy-sandy",
        "burmy-trash",
        "burmy",
        "butterfree-f",
        "butterfree-gmax-shiny",
        "butterfree-gmax",
        "butterfree",
        "buzzwole",
        "cacnea",
        "cacturne-f",
        "cacturne",
        "caimanoe",
        "calyrex-ice",
        "calyrex-shadow",
        "calyrex",
        "camerupt-f",
        "camerupt-mega",
        "camerupt",
        "capsakid",
        "carbink",
        "caribolt",
        "carkol-shiny",
        "carkol",
        "carnivine",
        "carracosta",
        "carvanha",
        "cascoon",
        "castform-rainy",
        "castform-snowy",
        "castform-sunny",
        "castform",
        "caterpie",
        "cawdet",
        "cawmodore",
        "celebi",
        "celesteela",
        "centiskorch-gmax",
        "centiskorch-shiny",
        "centiskorch",
        "ceruledge",
        "cetitan",
        "cetoddle",
        "chandelure",
        "chansey",
        "charcadet",
        "charizard-gmax",
        "charizard-megax",
        "charizard-megay",
        "charizard",
        "charjabug",
        "charmander",
        "charmeleon",
        "chatot",
        "cherrim-overcast",
        "cherrim-sunshine",
        "cherrim",
        "cherubi",
        "chesnaught",
        "chespin",
        "chewtle",
        "chienpao",
        "chikorita",
        "chimchar",
        "chimecho",
        "chinchou",
        "chingling",
        "chiyu",
        "chromera",
        "cinccino",
        "cinderace-gmax",
        "cinderace",
        "clamperl",
        "clauncher",
        "clawitzer",
        "claydol",
        "clefable",
        "clefairy",
        "cleffa",
        "clobbopus",
        "clodsire",
        "cloyster",
        "coalossal-gmax",
        "coalossal",
        "cobalion",
        "cofagrigus",
        "colossoil-f",
        "colossoil",
        "combee-f",
        "combee",
        "combusken-f",
        "combusken",
        "comfey",
        "conkeldurr",
        "copperajah-gmax-shiny",
        "copperajah-gmax",
        "copperajah-shiny",
        "copperajah",
        "coribalis",
        "corphish",
        "corsola-galar-shiny",
        "corsola-galar",
        "corsola",
        "corviknight-gmax",
        "corviknight",
        "corvisquire-shiny",
        "corvisquire",
        "cosmoem",
        "cosmog",
        "cottonee",
        "crabominable",
        "crabrawler",
        "cradily",
        "cramorant-gorging-shiny",
        "cramorant-gorging",
        "cramorant-gulping",
        "cramorant-shiny",
        "cramorant",
        "cranidos",
        "crawdaunt",
        "cresselia",
        "croagunk-f",
        "croagunk",
        "crobat",
        "crocalor",
        "croconaw",
        "crucibelle-mega",
        "crucibelle",
        "crustle",
        "cryogonal",
        "cubchoo",
        "cubone",
        "cufant-shiny",
        "cufant",
        "cupra",
        "cursola",
        "cutiefly",
        "cyclizar",
        "cyclohm-f",
        "cyclohm",
        "cyndaquil",
        "dachsbun",
        "darkrai",
        "darmanitan-galar",
        "darmanitan-galarzen",
        "darmanitan-standard",
        "darmanitan-zen",
        "darmanitan",
        "dartrix",
        "darumaka-galar-shiny",
        "darumaka-galar",
        "darumaka",
        "decidueye-hisui",
        "decidueye",
        "dedenne",
        "deerling-autumn",
        "deerling-spring",
        "deerling-summer",
        "deerling-winter",
        "deerling",
        "deino",
        "delcatty",
        "delibird",
        "delphox",
        "deoxys-attack",
        "deoxys-defense",
        "deoxys-rs",
        "deoxys-speed",
        "deoxys",
        "desktop",
        "dewgong",
        "dewott",
        "dewpider",
        "dhelmise",
        "dialga-origin",
        "dialga",
        "diancie-mega",
        "diancie",
        "diggersby",
        "diglett-alola",
        "diglett",
        "ditto",
        "dodrio-f",
        "dodrio",
        "doduo-f",
        "doduo",
        "dolliv",
        "dondozo",
        "donphan-f",
        "donphan",
        "dorsoil",
        "dottler",
        "doublade",
        "dracovish-shiny",
        "dracovish",
        "dracozolt-shiny",
        "dracozolt",
        "dragalage",
        "dragalge",
        "dragapult-shiny",
        "dragapult",
        "dragonair",
        "dragonite",
        "drakloak-shiny",
        "drakloak",
        "drampa",
        "drapion",
        "dratini",
        "drednaw-gmax-shiny",
        "drednaw-gmax",
        "drednaw-shiny",
        "drednaw",
        "dreepy-shiny",
        "dreepy",
        "drifblim",
        "drifloon",
        "drilbur",
        "drizzile-shiny",
        "drizzile",
        "drowzee",
        "druddigon",
        "dubwool-shiny",
        "dubwool",
        "ducklett",
        "dudunsparce-threesegment",
        "dudunsparce",
        "dugtrio-alola",
        "dugtrio",
        "dunsparce",
        "duohm",
        "duosion",
        "duraludon-gmax",
        "duraludon",
        "durant",
        "dusclops",
        "dusknoir",
        "duskull",
        "dustox-f",
        "dustox",
        "dwebble",
        "eelektrik",
        "eelektross",
        "eevee-gmax-shiny",
        "eevee-gmax",
        "eevee-starter-f",
        "eevee-starter",
        "eevee",
        "egg-manaphy",
        "egg",
        "eiscue-noice",
        "eiscue",
        "ekans",
        "eldegoss-shiny",
        "eldegoss",
        "electabuzz",
        "electivire",
        "electrelk",
        "electrike",
        "electrode-hisui",
        "electrode",
        "elekid",
        "elgyem",
        "embirch",
        "emboar",
        "emolga",
        "empoleon",
        "enamorus-therian",
        "enamorus",
        "entei",
        "equilibra",
        "escavalier",
        "espathra",
        "espeon",
        "espurr",
        "eternatus-eternamax-shiny",
        "eternatus-eternamax",
        "eternatus-shiny",
        "eternatus",
        "excadrill",
        "exeggcute",
        "exeggutor-alola",
        "exeggutor",
        "exploud",
        "falinks-shiny",
        "falinks",
        "farfetch'd-galar",
        "farfetchd-galar",
        "farfetchd",
        "farigiraf",
        "fawnifer",
        "fearow",
        "feebas",
        "fennekin",
        "feraligatr",
        "ferroseed",
        "ferrothorn",
        "fidgit-f",
        "fidgit",
        "fidough",
        "finizen",
        "finneon-f",
        "finneon",
        "flaaffy",
        "flabebe-blue",
        "flabebe-orange",
        "flabebe-white",
        "flabebe-yellow",
        "flabebe",
        "flamigo",
        "flapple-gmax",
        "flapple-shiny",
        "flapple",
        "flarelm-f",
        "flarelm",
        "flareon",
        "fletchinder",
        "fletchling",
        "flittle",
        "floatoy",
        "floatzel",
        "floette-blue",
        "floette-eternal",
        "floette-eternalflower",
        "floette-orange",
        "floette-white",
        "floette-yellow",
        "floette",
        "floragato",
        "florges-blue",
        "florges-orange",
        "florges-white",
        "florges-yellow",
        "florges",
        "fluttermane",
        "flygon",
        "fomantis",
        "foongus",
        "forretress",
        "fraxure",
        "frigibax",
        "frillish-f",
        "frillish",
        "froakie",
        "frogadier",
        "froslass",
        "frosmoth-shiny",
        "frosmoth",
        "fuecoco",
        "furfrou",
        "furret",
        "gabite-f",
        "gabite",
        "gallade-mega",
        "gallade",
        "galvantula",
        "garbodor-gmax",
        "garbodor",
        "garchomp-f",
        "garchomp-mega",
        "garchomp",
        "gardevoir-mega",
        "gardevoir",
        "garganacl",
        "gastly",
        "gastrodon-east",
        "gastrodon-west",
        "gastrodon",
        "genesect-burn",
        "genesect-chill",
        "genesect-douse",
        "genesect-shock",
        "genesect",
        "gengar-gmax-shiny",
        "gengar-gmax",
        "gengar-mega",
        "gengar",
        "geodude-alola",
        "geodude",
        "gholdengo",
        "gible-f",
        "gible",
        "gigalith",
        "gimmighoul-roaming",
        "gimmighoul",
        "girafarig-f",
        "girafarig",
        "giratina-altered",
        "giratina-origin",
        "giratina",
        "glaceon",
        "glalie-mega",
        "glalie",
        "glameow",
        "glastrier",
        "gligar-f",
        "gligar",
        "glimmet",
        "glimmora",
        "gliscor",
        "gloom-f",
        "gloom",
        "gogoat",
        "golbat-f",
        "golbat",
        "goldeen-f",
        "goldeen",
        "golduck",
        "golem-alola",
        "golem",
        "golett",
        "golisopod",
        "golurk",
        "goodra-hisui",
        "goodra",
        "goomy",
        "gorebyss",
        "gossifleur",
        "gothita",
        "gothitelle",
        "gothorita",
        "gourgeist-large",
        "gourgeist-small",
        "gourgeist-super",
        "gourgeist",
        "grafaiai",
        "granbull",
        "grapploct",
        "graveler-alola",
        "graveler",
        "greattusk",
        "greavard",
        "greedent",
        "greninja-ash",
        "greninja",
        "grimer-alola",
        "grimer",
        "grimmsnarl-gmax",
        "grimmsnarl",
        "grookey-shiny",
        "grookey",
        "grotle",
        "groudon-primal",
        "groudon",
        "grovyle",
        "growlithe-hisui",
        "growlithe",
        "grubbin",
        "grumpig",
        "gulpin-f",
        "gulpin",
        "gumshoos",
        "gurdurr",
        "guzzlord",
        "gyarados-f",
        "gyarados-mega",
        "gyarados",
        "gyrados-mega",
        "hakamoo",
        "happiny",
        "hariyama",
        "hatenna",
        "hatterene-gmax",
        "hatterene",
        "hattrem",
        "haunter",
        "hawlucha",
        "haxorus",
        "heatmor",
        "heatran",
        "heliolisk",
        "helioptile",
        "hemogoblin",
        "heracross-f",
        "heracross-mega",
        "heracross",
        "herdier",
        "hippopotas-f",
        "hippopotas",
        "hippowdon-f",
        "hippowdon",
        "hitmonchan",
        "hitmonlee",
        "hitmontop",
        "honchkrow",
        "honedge",
        "hooh",
        "hoopa-mega",
        "hoopa-unbound",
        "hoopa",
        "hoothoot",
        "hoppip",
        "horsea",
        "houndoom-f",
        "houndoom-mega",
        "houndoom",
        "houndour",
        "houndstone",
        "huntail",
        "hydreigon",
        "hypno-f",
        "hypno",
        "igglybuff",
        "illumise",
        "impidimp",
        "incineroar",
        "indeedee-f",
        "indeedee",
        "infernape",
        "inkay",
        "inteleon-gmax",
        "inteleon",
        "ironbundle",
        "ironhands",
        "ironjugulis",
        "ironleaves",
        "ironmoth",
        "ironthorns",
        "irontreads",
        "ironvaliant",
        "ivysaur",
        "jangmo-o",
        "jangmoo",
        "jellicent-f",
        "jellicent",
        "jigglypuff",
        "jirachi",
        "jolteon",
        "joltik",
        "jumbao",
        "jumpluff",
        "justyke",
        "jynx",
        "kabuto",
        "kabutops",
        "kadabra-f",
        "kadabra",
        "kakuna",
        "kangaskhan-mega",
        "kangaskhan",
        "karrablast",
        "kartana",
        "kecleon",
        "keldeo-resolute",
        "keldeo",
        "kerfluffle-f",
        "kerfluffle",
        "kilowattrel",
        "kingambit",
        "kingdra",
        "kingler-gmax",
        "kingler",
        "kirlia",
        "kitsunoh-f",
        "kitsunoh",
        "klang",
        "klawf",
        "kleavor",
        "klefki",
        "klink",
        "klinklang",
        "koffing",
        "komala",
        "kommoo",
        "koraidon",
        "krabby",
        "kricketot-f",
        "kricketot",
        "kricketune-f",
        "kricketune",
        "krillowatt-f",
        "krillowatt",
        "krilowatt-f",
        "krilowatt",
        "krokorok",
        "krolowatt",
        "krookodile",
        "kubfu",
        "kyogre-primal",
        "kyogre",
        "kyurem-black",
        "kyurem-white",
        "kyurem",
        "lairon",
        "lampent",
        "landorus-therian",
        "landorus",
        "lanturn",
        "lapras-gmax-shiny",
        "lapras-gmax",
        "lapras",
        "larvesta",
        "larvitar",
        "latias-mega",
        "latias",
        "latios-mega",
        "latios",
        "leafeon",
        "leavanny",
        "lechonk",
        "ledian-f",
        "ledian",
        "ledyba-f",
        "ledyba",
        "lickilicky",
        "lickitung",
        "liepard",
        "lileep",
        "lilligant-hisui",
        "lilligant",
        "lillipup",
        "linoone-galar-shiny",
        "linoone-galar",
        "linoone",
        "litleo",
        "litten",
        "litwick",
        "lokix",
        "lombre",
        "lopunny-mega",
        "lopunny",
        "lotad",
        "loudred",
        "lucario-mega",
        "lucario",
        "ludicolo-f",
        "ludicolo",
        "lugia",
        "lumineon-f",
        "lumineon",
        "lunala",
        "lunatone",
        "lurantis",
        "luvdisc",
        "luxio-f",
        "luxio",
        "luxray-f",
        "luxray",
        "lycanroc-dusk",
        "lycanroc-midday",
        "lycanroc-midnight",
        "lycanroc",
        "mabosstiff",
        "machamp-gmax",
        "machamp",
        "machoke",
        "machop",
        "magby",
        "magcargo",
        "magearna-original",
        "magearna-pokeball",
        "magearna",
        "magikarp-f",
        "magikarp",
        "magmar",
        "magmortar",
        "magnemite",
        "magneton",
        "magnezone",
        "makuhita",
        "malaconda",
        "malamar",
        "mamoswine-f",
        "mamoswine",
        "manaphy",
        "mandibuzz",
        "manectric-mega",
        "manectric",
        "manetric-mega",
        "mankey",
        "mantine",
        "mantyke",
        "maractus",
        "mareanie",
        "mareep",
        "marenie",
        "marill",
        "marowak-alola",
        "marowak-alolan",
        "marowak",
        "marshadow",
        "marshtomp",
        "maschiff",
        "masquerain",
        "maushold-four",
        "maushold",
        "mawile-mega",
        "mawile",
        "medicham-f",
        "medicham-mega",
        "medicham",
        "meditite-f",
        "meditite",
        "meganium-f",
        "meganium",
        "melmetal-gmax",
        "melmetal",
        "meloetta-aria",
        "meloetta-pirouette",
        "meloetta",
        "meltan",
        "meowscarada",
        "meowstic-f",
        "meowstic",
        "meowth-alola",
        "meowth-galar",
        "meowth-gmax",
        "meowth",
        "mesprit",
        "metagross-mega",
        "metagross",
        "metang",
        "metapod",
        "mew",
        "mewtwo-megax",
        "mewtwo-megay",
        "mewtwo",
        "miasmaw",
        "miasmite",
        "mienfoo",
        "mienshao",
        "mightyena",
        "milcery",
        "milotic-f",
        "milotic",
        "miltank",
        "mimejr",
        "mimikyu-busted",
        "mimikyu",
        "minccino",
        "minior-blue",
        "minior-green",
        "minior-indigo",
        "minior-meteor",
        "minior-orange",
        "minior-red",
        "minior-violet",
        "minior-yellow",
        "minior",
        "minun",
        "miraidon",
        "misdreavus",
        "mismagius",
        "missingno",
        "mollux",
        "moltres-galar",
        "moltres",
        "monferno",
        "monohm",
        "morelull",
        "morgrem",
        "morpeko-hangry-shiny",
        "morpeko-hangry",
        "morpeko-shiny",
        "morpeko",
        "mothim",
        "mrmime-galar",
        "mrmime",
        "mrrime",
        "mudbray",
        "mudkip",
        "mudsdale",
        "muk-alola",
        "muk",
        "mumbao",
        "munchlax",
        "munna",
        "murkrow-f",
        "murkrow",
        "musharna",
        "nacli",
        "naclstack",
        "naganadel",
        "natu",
        "naviathan",
        "necrozma-dawnwings",
        "necrozma-duskmane",
        "necrozma-ultra",
        "necrozma",
        "necturine",
        "necturna",
        "nickit",
        "nidoking",
        "nidoqueen",
        "nidoranf",
        "nidoranm",
        "nidorina",
        "nidorino",
        "nihilego",
        "nincada",
        "ninetales-alola",
        "ninetales",
        "ninjask",
        "noctowl",
        "nohface",
        "noibat",
        "noivern",
        "nosepass",
        "numel-f",
        "numel",
        "nuzleaf-f",
        "nuzleaf",
        "nymble",
        "obstagoon-shiny",
        "obstagoon",
        "octillery-f",
        "octillery",
        "oddish",
        "oinkologne-f",
        "oinkologne",
        "omanyte",
        "omastar",
        "onix",
        "oranguru",
        "orbeetle-gmax",
        "orbeetle",
        "oricorio-pau",
        "oricorio-pompom",
        "oricorio-sensu",
        "oricorio",
        "orthworm",
        "oshawott",
        "overqwil",
        "pachirisu-f",
        "pachirisu",
        "pajantom",
        "palafin-hero",
        "palafin",
        "palkia-origin",
        "palkia",
        "palossand",
        "palpitoad",
        "pancham",
        "pangoro",
        "panpour",
        "pansage",
        "pansear",
        "paras",
        "parasect",
        "passimian",
        "patrat",
        "pawmi",
        "pawmo",
        "pawmot",
        "pawniard",
        "pelipper",
        "perrserker",
        "persian-alola",
        "persian",
        "petilil",
        "phanpy",
        "phantump",
        "pheromosa",
        "phione",
        "pichu-spikyeared",
        "pichu",
        "pidgeot-mega",
        "pidgeot",
        "pidgeotto",
        "pidgey",
        "pidove",
        "pignite",
        "pikachu-alola",
        "pikachu-belle",
        "pikachu-cosplay",
        "pikachu-f",
        "pikachu-gmax-shiny",
        "pikachu-gmax",
        "pikachu-hoenn",
        "pikachu-kalos",
        "pikachu-libre",
        "pikachu-original",
        "pikachu-partner",
        "pikachu-phd",
        "pikachu-popstar",
        "pikachu-rockstar",
        "pikachu-sinnoh",
        "pikachu-starter-f",
        "pikachu-starter",
        "pikachu-unova",
        "pikachu-world",
        "pikachu",
        "pikipek",
        "piloswine-f",
        "piloswine",
        "pincurchin-shiny",
        "pincurchin",
        "pineco",
        "pinsir-mega",
        "pinsir",
        "piplup",
        "plasmanta",
        "pluffle",
        "plusle",
        "poipole",
        "pokestarblackbelt-prop",
        "pokestarblackbelt",
        "pokestarblackdoor-prop",
        "pokestarblackdoor",
        "pokestarbrycenman-prop",
        "pokestarbrycenman",
        "pokestarf00-prop",
        "pokestarf00",
        "pokestarf002-prop",
        "pokestarf002",
        "pokestargiant-2",
        "pokestargiant-prop",
        "pokestargiant",
        "pokestargiant2-prop",
        "pokestargiant2",
        "pokestarhumanoid-prop",
        "pokestarhumanoid",
        "pokestarmonster-prop",
        "pokestarmonster",
        "pokestarmt-prop",
        "pokestarmt",
        "pokestarmt2-prop",
        "pokestarmt2",
        "pokestarsmeargle",
        "pokestarspirit-prop",
        "pokestarspirit",
        "pokestartransport-prop",
        "pokestartransport",
        "pokestarufo-2",
        "pokestarufo-prop",
        "pokestarufo-propu2",
        "pokestarufo",
        "pokestarufo2-prop",
        "pokestarufo2",
        "pokestarwhitedoor-prop",
        "pokestarwhitedoor",
        "politoed-f",
        "politoed",
        "poliwag",
        "poliwhirl",
        "poliwrath",
        "polteageist-antique",
        "polteageist-chipped",
        "polteageist",
        "ponyta-galar-shiny",
        "ponyta-galar",
        "ponyta",
        "poochyena",
        "popplio",
        "porygon",
        "porygon2",
        "porygonz",
        "primarina",
        "primeape",
        "prinplup",
        "privatyke",
        "probopass",
        "protowatt-f",
        "protowatt",
        "psyduck",
        "pumpkaboo-large",
        "pumpkaboo-small",
        "pumpkaboo-super",
        "pumpkaboo",
        "pupitar",
        "purrloin",
        "purugly",
        "pyroak-f",
        "pyroak",
        "pyroar-f",
        "pyroar",
        "pyukumuku",
        "quagsire-f",
        "quagsire",
        "quaquaval",
        "quaxly",
        "quaxwell",
        "quilava",
        "quilladin",
        "qwilfish-hisui",
        "qwilfish",
        "raboot-shiny",
        "raboot",
        "rabsca",
        "raichu-alola",
        "raichu-f",
        "raichu",
        "raikou",
        "ralts",
        "rampardos",
        "rapidash-galar-shiny",
        "rapidash-galar",
        "rapidash",
        "raticate-alola",
        "raticate-f",
        "raticate",
        "rattata-alola",
        "rattata-alolan",
        "rattata-f",
        "rattata",
        "rayquaza-mega",
        "rayquaza",
        "rebble",
        "regice",
        "regidrago",
        "regidragon",
        "regieleki",
        "regigigas",
        "regirock",
        "registeel",
        "relicanth-f",
        "relicanth",
        "rellor",
        "remoraid",
        "reshiram",
        "reuniclus",
        "revavroom",
        "revenankh-f",
        "revenankh",
        "rhydon-f",
        "rhydon",
        "rhyhorn-f",
        "rhyhorn",
        "rhyperior-f",
        "rhyperior",
        "ribombee",
        "rillaboom-gmax",
        "rillaboom-shiny",
        "rillaboom",
        "riolu",
        "roaringmoon",
        "rockruff",
        "roggenrola",
        "rolycoly",
        "rookidee",
        "roselia-f",
        "roselia",
        "roserade-f",
        "roserade",
        "rotom-fan",
        "rotom-frost",
        "rotom-heat",
        "rotom-mow",
        "rotom-wash",
        "rotom",
        "rowlet",
        "rufflet",
        "runerigus-shiny",
        "runerigus",
        "sableye-mega",
        "sableye",
        "saharaja",
        "saharascal",
        "salamence-mega",
        "salamence",
        "salandit",
        "salazzle",
        "samurott-hisui",
        "samurott",
        "sandaconda-gmax",
        "sandaconda-shiny",
        "sandaconda",
        "sandile",
        "sandshrew-alola",
        "sandshrew",
        "sandslash-alola",
        "sandslash",
        "sandygast",
        "sandyshocks",
        "sawk",
        "sawsbuck-autumn",
        "sawsbuck-spring",
        "sawsbuck-summer",
        "sawsbuck-winter",
        "sawsbuck",
        "scatterbug",
        "scattervein",
        "sceptile-mega",
        "sceptile",
        "scizor-f",
        "scizor-mega",
        "scizor",
        "scolipede",
        "scorbunny-shiny",
        "scorbunny",
        "scovillain",
        "scrafty",
        "scraggy",
        "scratchet-f",
        "scratchet",
        "screamtail",
        "scyther-f",
        "scyther",
        "seadra",
        "seaking-f",
        "seaking",
        "sealeo",
        "seedot",
        "seel",
        "seismitoad",
        "sentret",
        "serperior",
        "servine",
        "seviper",
        "sewaddle",
        "sharpedo-mega",
        "sharpedo",
        "shaymin-land",
        "shaymin-sky",
        "shaymin",
        "shedinja",
        "shelgon",
        "shellder",
        "shellos-east",
        "shellos-west",
        "shellos",
        "shelmet",
        "shieldon",
        "shiftry-f",
        "shiftry",
        "shiinotic",
        "shinx-f",
        "shinx",
        "shroodle",
        "shroomish",
        "shuckle",
        "shuppet",
        "sigilyph",
        "silcoon",
        "silicobra-shiny",
        "silicobra",
        "silvally-bug",
        "silvally-dark",
        "silvally-dragon",
        "silvally-electric",
        "silvally-fairy",
        "silvally-fighting",
        "silvally-fire",
        "silvally-flying",
        "silvally-ghost",
        "silvally-grass",
        "silvally-ground",
        "silvally-ice",
        "silvally-poison",
        "silvally-psychic",
        "silvally-rock",
        "silvally-steel",
        "silvally-water",
        "silvally",
        "simipour",
        "simisage",
        "simisear",
        "sinistea-antique",
        "sinistea-chipped",
        "sinistea",
        "sirfetchd",
        "sizzlipede",
        "skarmory",
        "skeledirge",
        "skiddo",
        "skiploom",
        "skitty",
        "skorupi",
        "skrelp",
        "skuntank",
        "skwovet",
        "slaking",
        "slakoth",
        "sliggoo-hisui",
        "sliggoo",
        "slitherwing",
        "slowbro-galar",
        "slowbro-mega",
        "slowbro",
        "slowking-galar",
        "slowking",
        "slowpoke-galar",
        "slowpoke",
        "slugma",
        "slurpuff",
        "smeargle",
        "smogecko",
        "smoguana",
        "smokomodo",
        "smoliv",
        "smoochum",
        "snaelstrom",
        "sneasel-f",
        "sneasel-hisui-f",
        "sneasel-hisui",
        "sneasel",
        "sneasler",
        "snivy",
        "snom-shiny",
        "snom",
        "snorlax-gmax",
        "snorlax",
        "snorunt",
        "snover-f",
        "snover",
        "snubbull",
        "snugglow",
        "sobble-shiny",
        "sobble",
        "solgaleo",
        "solosis",
        "solotl",
        "solrock",
        "spearow",
        "spectrier",
        "spewpa",
        "spheal",
        "spidops",
        "spinarak",
        "spinda",
        "spiritomb",
        "spoink",
        "sprigatito",
        "spritzee",
        "squawkabilly-blue",
        "squawkabilly-white",
        "squawkabilly-yellow",
        "squawkabilly",
        "squirtle",
        "stakataka",
        "stantler",
        "staraptor-f",
        "staraptor",
        "staravia-f",
        "staravia",
        "starly-f",
        "starly",
        "starmie",
        "staryu",
        "steelix-f",
        "steelix-mega",
        "steelix",
        "steenee",
        "stonjourner-shiny",
        "stonjourner",
        "stoutland",
        "stratagem",
        "stufful",
        "stunfisk-galar-shiny",
        "stunfisk-galar",
        "stunfisk",
        "stunky",
        "substitute",
        "sudowoodo-f",
        "sudowoodo",
        "suicune",
        "sunflora",
        "sunkern",
        "surskit",
        "swablu",
        "swadloon",
        "swalot-f",
        "swalot",
        "swampert-mega",
        "swampert",
        "swanna",
        "swellow",
        "swinub",
        "swirlix",
        "swirlpool",
        "swoobat",
        "syclant-f",
        "syclant",
        "syclar",
        "sylveon",
        "tactite",
        "tadbulb",
        "taillow",
        "talonflame",
        "tandemaus",
        "tangela",
        "tangrowth-f",
        "tangrowth",
        "tapubulu",
        "tapufini",
        "tapukoko",
        "tapulele",
        "tarountula",
        "tatsugiri-droopy",
        "tatsugiri-stretchy",
        "tatsugiri",
        "tauros-paldea",
        "tauros-paldeaaqua",
        "tauros-paldeablaze",
        "tauros-paldeacombat",
        "tauros-paldeafire",
        "tauros-paldeawater",
        "tauros",
        "teddiursa",
        "tentacool",
        "tentacruel",
        "tepig",
        "terrakion",
        "thievul",
        "throh",
        "thundurus-therian",
        "thundurus",
        "thwackey-shiny",
        "thwackey",
        "timburr",
        "tinglu",
        "tinkatink",
        "tinkaton",
        "tinkatuff",
        "tirtouga",
        "toedscool",
        "toedscruel",
        "togedemaru",
        "togekiss",
        "togepi",
        "togetic",
        "tomohawk-f",
        "tomohawk",
        "torchic",
        "torkoal",
        "tornadus-therian",
        "tornadus",
        "torracat",
        "torterra",
        "totodile",
        "toucannon",
        "toxapex",
        "toxel",
        "toxicroak-f",
        "toxicroak",
        "toxtricity-gmax",
        "toxtricity-lowkey",
        "toxtricity",
        "tranquill",
        "trapinch",
        "treecko",
        "trevenant",
        "tropius",
        "trubbish",
        "trumbeak",
        "tsareena",
        "turtonator",
        "turtwig",
        "tympole",
        "tynamo",
        "typenull",
        "typhlosion-hisui",
        "typhlosion",
        "tyranitar-mega",
        "tyranitar",
        "tyrantrum",
        "tyrogue",
        "tyrunt",
        "umbreon",
        "unfezant-f",
        "unfezant",
        "unown-a",
        "unown-b",
        "unown-c",
        "unown-d",
        "unown-e",
        "unown-em",
        "unown-f",
        "unown-g",
        "unown-h",
        "unown-i",
        "unown-j",
        "unown-k",
        "unown-l",
        "unown-m",
        "unown-n",
        "unown-o",
        "unown-p",
        "unown-q",
        "unown-qm",
        "unown-r",
        "unown-s",
        "unown-t",
        "unown-u",
        "unown-v",
        "unown-w",
        "unown-x",
        "unown-y",
        "unown-z",
        "unown",
        "ursaluna",
        "ursaring-f",
        "ursaring",
        "urshifu-gmax",
        "urshifu-rapidstrike",
        "urshifu-rapidstrikegmax",
        "urshifu",
        "uxie",
        "vanillish",
        "vanillite",
        "vanilluxe",
        "vaporeon",
        "varoom",
        "veluza",
        "venipede",
        "venomicon-epilogue",
        "venomicon",
        "venomoth",
        "venonat",
        "venusaur-f",
        "venusaur-gmax",
        "venusaur-mega-f",
        "venusaur-mega",
        "venusaur",
        "vespiquen",
        "vibrava",
        "victini",
        "victreebel",
        "vigoroth",
        "vikavolt",
        "vileplume-f",
        "vileplume",
        "virizion",
        "vivillon-fancy",
        "vivillon-pokeball",
        "vivillon",
        "volbeat",
        "volcanion",
        "volcarona",
        "volkraken",
        "volkritter",
        "voltorb-hisui",
        "voltorb",
        "voodoll",
        "voodoom-f",
        "voodoom",
        "vullaby",
        "vulpix-alola",
        "vulpix",
        "wailmer",
        "wailord",
        "walkingwake",
        "walrein",
        "wartortle",
        "watchog",
        "wattrel",
        "weavile-f",
        "weavile",
        "weedle",
        "weepinbell",
        "weezing-galar",
        "weezing",
        "whimsicott",
        "whirlipede",
        "whiscash",
        "whismur",
        "wigglytuff",
        "wiglett",
        "wimpod",
        "wingull",
        "wishiwashi-school",
        "wishiwashi-solo",
        "wishiwashi",
        "wobbuffet-f",
        "wobbuffet",
        "wochien",
        "woobat",
        "wooloo-shiny",
        "wooloo",
        "wooper-f",
        "wooper-paldea",
        "wooper",
        "wormadam-plant",
        "wormadam-sandy",
        "wormadam-trash",
        "wormadam",
        "wugtrio",
        "wurmple",
        "wynaut",
        "wyrdeer",
        "xatu-f",
        "xatu",
        "xerneas-neutral",
        "xerneas",
        "xurkitree",
        "yamask-galar",
        "yamask",
        "yamper",
        "yanma",
        "yanmega",
        "yungoos",
        "yveltal",
        "zacian-crowned-shiny",
        "zacian-crowned",
        "zacian",
        "zamazenta-crowned-shiny",
        "zamazenta-crowned",
        "zamazenta",
        "zangoose",
        "zapdos-galar",
        "zapdos",
        "zarude-dada",
        "zarude",
        "zebstrika",
        "zekrom",
        "zeraora",
        "zigzagoon-galar",
        "zigzagoon",
        "zoroark-hisui",
        "zoroark",
        "zorua-hisui",
        "zorua",
        "zubat-f",
        "zubat",
        "zweilous",
        "zygarde-10",
        "zygarde-complete",
        "zygarde",
    ];

    #[test]
    fn t() -> Result<(), Box<dyn Error>> {
        for name in ALL_NAMES.iter() {
            std::fs::metadata(format!("poster/assets/pokemon/{}.png", name))
                .expect(format!("Missing file for {}", name).as_str());
        }
        Ok(())
    }
}
